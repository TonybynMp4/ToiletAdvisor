# Dev image: installs deps once, then docker-compose mounts your repo for hot reload.
FROM node:20-alpine

WORKDIR /app

# Enable pnpm via corepack
RUN corepack enable

# Keep pnpm store in a volume-friendly path
ENV PNPM_STORE_DIR=/pnpm-store

# Copy minimal files for dependency install caching
COPY pnpm-lock.yaml pnpm-workspace.yaml package.json ./
COPY apps/api-server/package.json apps/api-server/package.json
COPY apps/auth-server/package.json apps/auth-server/package.json
COPY apps/web/package.json apps/web/package.json
COPY packages/api/package.json packages/api/package.json
COPY packages/auth/package.json packages/auth/package.json
COPY packages/config/package.json packages/config/package.json
COPY packages/db/package.json packages/db/package.json
COPY packages/env/package.json packages/env/package.json

RUN pnpm install --frozen-lockfile

# default command overridden by compose
CMD ["node", "-e", "console.log('dev image ready')"]
